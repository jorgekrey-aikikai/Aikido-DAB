<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aikido Techniken Lernkarten</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f5f5f5;
            padding: 10px;
            padding-bottom: 80px;
        }

        .header {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 10px;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #333;
        }

        .filter-bar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .filter-btn {
            padding: 10px 16px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.2s;
            flex: 1;
            min-width: 80px;
        }

        .filter-btn.active {
            border-color: currentColor;
            background: currentColor;
            color: white;
        }

        .filter-btn.gelb { color: #FDB813; }
        .filter-btn.orange { color: #FF8C00; }
        .filter-btn.gruen { color: #2E7D32; }
        .filter-btn.blau { color: #1976D2; }
        .filter-btn.braun { color: #5D4037; }
        .filter-btn.alle { color: #666; }

        .stats {
            font-size: 0.85em;
            color: #666;
            margin-top: 10px;
        }

        .card {
            background: white;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-header {
            padding: 15px;
            cursor: pointer;
            user-select: none;
            position: relative;
            border-left: 4px solid;
        }

        .card-header.gelb { border-left-color: #FDB813; }
        .card-header.orange { border-left-color: #FF8C00; }
        .card-header.gruen { border-left-color: #2E7D32; }
        .card-header.blau { border-left-color: #1976D2; }
        .card-header.braun { border-left-color: #5D4037; }

        .card-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .card-subtitle {
            font-size: 0.9em;
            color: #666;
        }

        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .card.expanded .card-content {
            max-height: 1000px;
        }

        .card-body {
            padding: 15px;
            background: #fafafa;
            border-top: 1px solid #eee;
        }

        .info-row {
            margin-bottom: 12px;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }

        .info-label {
            font-size: 0.8em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 0.95em;
            color: #333;
        }

        .video-links {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .video-btn {
            flex: 1;
            padding: 10px;
            background: #1976D2;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .video-btn:active {
            background: #1565C0;
        }

        .status-buttons {
            display: flex;
            gap: 8px;
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
        }

        .status-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.2s;
        }

        .status-btn.kann-ich {
            border-color: #2E7D32;
            color: #2E7D32;
        }

        .status-btn.kann-ich.active {
            background: #2E7D32;
            color: white;
        }

        .status-btn.geht-so {
            border-color: #FF8C00;
            color: #FF8C00;
        }

        .status-btn.geht-so.active {
            background: #FF8C00;
            color: white;
        }

        .status-btn.katastrophe {
            border-color: #D32F2F;
            color: #D32F2F;
        }

        .status-btn.katastrophe.active {
            background: #D32F2F;
            color: white;
        }

        .expand-indicator {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            color: #999;
            transition: transform 0.3s;
        }

        .card.expanded .expand-indicator {
            transform: translateY(-50%) rotate(180deg);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        @media (max-width: 600px) {
            .filter-btn {
                font-size: 0.85em;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Aikido Techniken</h1>
        <div class="filter-bar" id="filterBar"></div>
        <div class="stats" id="stats"></div>
    </div>

    <div id="cardContainer"></div>

    <div class="empty-state" id="emptyState" style="display: none;">
        Keine Techniken gefunden
    </div>

    <script>
        let techniques = [];
        let currentFilter = 'alle';
        let userProgress = {};

        // Farben-Mapping
        const colorMap = {
            'Gelb (5. Kyu)': 'gelb',
            'Orange (4. Kyu)': 'orange',
            'Grün (3. Kyu)': 'gruen',
            'Blau (2. Kyu)': 'blau',
            'Braun (1. Kyu)': 'braun'
        };

        // Lokalen Speicher laden
        function loadProgress() {
            const saved = localStorage.getItem('aikidoProgress');
            if (saved) {
                userProgress = JSON.parse(saved);
            }
        }

        // Lokalen Speicher speichern
        function saveProgress() {
            localStorage.setItem('aikidoProgress', JSON.stringify(userProgress));
        }

        // CSV laden und parsen
        async function loadData() {
            try {
                const response = await fetch('techniken.csv');
                const text = await response.text();
                parseCSV(text);
            } catch (error) {
                console.error('Fehler beim Laden der Daten:', error);
                document.getElementById('emptyState').style.display = 'block';
            }
        }

        // CSV parsen
        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split('\t');
            
            techniques = [];
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split('\t');
                if (values.length < 7) continue;

                techniques.push({
                    id: i,
                    technik: values[0]?.trim() || '',
                    variation: values[1]?.trim() || '',
                    angriffJap: values[2]?.trim() || '',
                    angriffDe: values[3]?.trim() || '',
                    farbe: values[4]?.trim() || '',
                    videoKarl: values[5]?.trim() || '',
                    videoArt: values[6]?.trim() || ''
                });
            }

            createFilterButtons();
            renderCards();
        }

        // Filter-Buttons erstellen
        function createFilterButtons() {
            const filterBar = document.getElementById('filterBar');
            const colors = [...new Set(techniques.map(t => t.farbe))].sort();
            
            let html = '<button class="filter-btn alle active" onclick="setFilter(\'alle\')">Alle</button>';
            
            colors.forEach(color => {
                const colorClass = colorMap[color] || 'alle';
                html += `<button class="filter-btn ${colorClass}" onclick="setFilter('${color}')">${color.split(' ')[0]}</button>`;
            });
            
            filterBar.innerHTML = html;
        }

        // Filter setzen
        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderCards();
        }

        // Karten rendern
        function renderCards() {
            const container = document.getElementById('cardContainer');
            const emptyState = document.getElementById('emptyState');
            
            const filtered = currentFilter === 'alle' 
                ? techniques 
                : techniques.filter(t => t.farbe === currentFilter);

            if (filtered.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                updateStats(0, 0);
                return;
            }

            emptyState.style.display = 'none';
            
            let html = '';
            filtered.forEach(tech => {
                const colorClass = colorMap[tech.farbe] || 'alle';
                const status = userProgress[tech.id] || '';
                
                const title = [tech.technik, tech.variation].filter(Boolean).join(' - ');
                
                html += `
                    <div class="card" id="card-${tech.id}">
                        <div class="card-header ${colorClass}" onclick="toggleCard(${tech.id})">
                            <div class="card-title">${title}</div>
                            <div class="card-subtitle">${tech.angriffJap}</div>
                            <span class="expand-indicator">▼</span>
                        </div>
                        <div class="card-content">
                            <div class="card-body">
                                ${tech.angriffDe ? `
                                <div class="info-row">
                                    <div class="info-label">Deutsche Beschreibung</div>
                                    <div class="info-value">${tech.angriffDe}</div>
                                </div>
                                ` : ''}
                                
                                ${tech.videoKarl || tech.videoArt ? `
                                <div class="info-row">
                                    <div class="info-label">Videos</div>
                                    <div class="video-links">
                                        ${tech.videoKarl ? `<a href="${tech.videoKarl}" target="_blank" class="video-btn">Karl Ruben</a>` : ''}
                                        ${tech.videoArt ? `<a href="${tech.videoArt}" target="_blank" class="video-btn">Art of Aikido</a>` : ''}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                            <div class="status-buttons">
                                <button class="status-btn kann-ich ${status === 'kann-ich' ? 'active' : ''}" 
                                        onclick="setStatus(${tech.id}, 'kann-ich')">✓ Kann ich</button>
                                <button class="status-btn geht-so ${status === 'geht-so' ? 'active' : ''}" 
                                        onclick="setStatus(${tech.id}, 'geht-so')">~ Geht so</button>
                                <button class="status-btn katastrophe ${status === 'katastrophe' ? 'active' : ''}" 
                                        onclick="setStatus(${tech.id}, 'katastrophe')">✗ Katastrophe</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateStats(filtered.length, techniques.length);
        }

        // Karte auf-/zuklappen
        function toggleCard(id) {
            const card = document.getElementById(`card-${id}`);
            card.classList.toggle('expanded');
        }

        // Status setzen
        function setStatus(id, status) {
            event.stopPropagation();
            
            if (userProgress[id] === status) {
                delete userProgress[id];
            } else {
                userProgress[id] = status;
            }
            
            saveProgress();
            renderCards();
        }

        // Statistik aktualisieren
        function updateStats(shown, total) {
            const stats = document.getElementById('stats');
            const kannIch = Object.values(userProgress).filter(s => s === 'kann-ich').length;
            const gehtSo = Object.values(userProgress).filter(s => s === 'geht-so').length;
            const katastrophe = Object.values(userProgress).filter(s => s === 'katastrophe').length;
            
            stats.innerHTML = `
                ${shown} von ${total} Techniken | 
                <span style="color: #2E7D32">✓ ${kannIch}</span> | 
                <span style="color: #FF8C00">~ ${gehtSo}</span> | 
                <span style="color: #D32F2F">✗ ${katastrophe}</span>
            `;
        }

        // Init
        loadProgress();
        loadData();
    </script>
</body>
</html>
